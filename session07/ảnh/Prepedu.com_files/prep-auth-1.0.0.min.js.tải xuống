(() => {
  const r = "login_phone_password_done", l = "login_username_password_done", h = "register_done_without_first_login", p = "login_otp_done_with_first_login", c = "register_done_with_first_login", d = "close_popup_auth", u = "finish_first_login", s = "config_auth_popup";
  window.PrepAuth = new class {
    constructor() {
      this.baseDomain = "", this.iframeAuth = null, this.iframeFirstLogin = null, this.locale = "vi";
    }
    init(i = {}) {
      this.locale = i.locale || "vi", this.baseDomain = i.baseDomain, this.initIframeAuth(), this.initIframeFirstLogin();
    }
    setLocale(i) {
      if (i === this.locale) return;
      const o = this.locale;
      this.locale = i, (() => {
        if (!this.iframeAuth) return;
        const t = this.iframeAuth.src;
        this.iframeAuth.src = t.replace(`${this.baseDomain}/${o}`, `${this.baseDomain}/${this.locale}`);
      })()(() => {
        if (!this.iframeFirstLogin) return;
        const t = this.iframeFirstLogin.src;
        this.iframeFirstLogin.src = t.replace(`${this.baseDomain}/${o}`, `${this.baseDomain}/${this.locale}`);
      })();
    }
    initIframeAuth() {
      let i = document.getElementById("prep-auth-iframe");
      i || (i = document.createElement("iframe"), i.id = "prep-auth-iframe", i.src = `${window.location.protocol}//${this.baseDomain}/${this.locale}/auth/login-popup`, i.sandbox = "allow-forms allow-scripts allow-popups allow-same-origin allow-top-navigation", i.style = `
        display: none;
        visibility: visible;
        position: fixed;
        left: 0px;
        top: 0px;
        width: 100%;
        height: 100%;
        z-index: 2147483647;
        padding: 0px;
        margin: 0px;
        border: 0px none transparent;
        background-color: rgba(0, 0, 0, 0);
        overflow: hidden auto;
        -webkit-tap-highlight-color: transparent;
        transition: background-color 0.2s;
      `, document.body.appendChild(i)), this.iframeAuth = i;
    }
    initIframeFirstLogin() {
      let i = document.getElementById("prep-auth-first-login-iframe");
      i || (i = document.createElement("iframe"), i.id = "prep-auth-first-login-iframe", i.src = `${window.location.protocol}//${this.baseDomain}/${this.locale}/auth/first-login`, i.sandbox = "allow-forms allow-scripts allow-popups allow-same-origin allow-top-navigation", i.style = `
        display: none;
        visibility: visible;
        position: fixed;
        left: 0px;
        top: 0px;
        width: 100%;
        height: 100%;
        z-index: 2147483647;
        padding: 0px;
        margin: 0px;
        border: 0px none transparent;
        background-color: rgba(0, 0, 0, 0);
        overflow: hidden auto;
        -webkit-tap-highlight-color: transparent;
        transition: background-color 0.2s;
      `, document.body.appendChild(i)), this.iframeFirstLogin = i;
    }
    openPopupAuth(i = {}) {
      const o = i.title, t = i.isFirstLogin || !1, n = i.onPopupClose || function() {
      }, g = i.onAuthSuccess || function() {
      };
      this.iframeAuth && (this.iframeAuth.contentWindow.postMessage({ type: s, data: { title: o, isFirstLogin: t, pageUrl: window.location.href } }, "*"), window.addEventListener("message", (m) => {
        const { type: a, data: e } = m.data || {};
        switch (a) {
          case r:
          case l:
          case h:
          case p:
          case c:
            this.closePopupAuth(), g(a);
            break;
          case d:
            this.closePopupAuth(), n(e == null ? void 0 : e.isLoggedIn);
        }
      }), this.iframeAuth.style.display = "block", this.iframeAuth.style.backgroundColor = "rgba(0, 0, 0, 0.4)");
    }
    closePopupAuth() {
      this.iframeAuth && (this.iframeAuth.style.display = "none", this.iframeAuth.style.backgroundColor = "rgba(0, 0, 0, 0)");
    }
    openPopupFirstLogin(i = {}) {
      const o = i.onSuccess || function() {
      };
      this.iframeAuth && (this.iframeAuth.contentWindow.postMessage({ type: s, data: { pageUrl: window.location.href } }, "*"), window.addEventListener("message", (t) => {
        const { type: n } = t.data || {};
        n === u && (this.closePopupFirstLogin(), o());
      }), this.iframeFirstLogin.style.display = "block", this.iframeFirstLogin.style.backgroundColor = "rgba(0, 0, 0, 0.4)");
    }
    closePopupFirstLogin() {
      this.iframeFirstLogin && (this.iframeFirstLogin.style.display = "none", this.iframeFirstLogin.style.backgroundColor = "rgba(0, 0, 0, 0)");
    }
  }();
})();
